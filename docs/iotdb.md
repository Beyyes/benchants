# TSBS Supplemental Guide: Apache IoTDB

**This should be read *after* the main README.**

Apache IoTDB (Database for Internet of Things) is an IoT native database with
high performance for data management and analysis, deployable on the edge and
the cloud. For more details about Apache IoTDB, please take a look at:
[https://iotdb.apache.org/](https://iotdb.apache.org/)

This supplemental guide explains how the data generated for TSBS is stored,
additional flags available when using the data importer (`tsbs_load_iotdb`),
and additional flags available for the query runner (`tsbs_run_queries_iotdb`).

## Data format

Data generated by `tsbs_generate_data` for IoTDB is serialized in a "pseudo-CSV"
format, along with a custom header at the beginning:

* one line composed of a comma-separated list of "deviceID" and fieldNames
* one line composed of a comma-separated list of deviceID and fieldValues

For example:

```text
deviceID,timestamp,<fieldName1>,<fieldName2>,<fieldName3>,...
<deviceID>,<timestamp>,<field1>,<field2>,<field3>,...
datatype,<datatype1>,<datatype2>,<datatype3>,...

deviceID,timestamp,hostname,value
root.cpu.host_1,1451606400000000000,'host_1',44.0
datatype,5,2
```

`deviceID` describes the storage path which is composed of several nodes.
IoTDB uses storage group to manage data. For example, in test case `devops`,
if `measurementName` is `cpu` while `hostname` tag is `host_0`, then `deviceID`
is `root.cpu.host_0`.
IoTDB treat tags as fields, except primary key like `hostname` in `devops`.
The unit of timestamp in generated data is nanosecond, but it will be converted
into millisecond before insert into database.

An example for the `cpu-only` use case:

```text
deviceID,timestamp,region,datacenter,rack,os,arch,team,service,service_version,service_environment,usage_user,usage_system,usage_idle,usage_nice,usage_iowait,usage_irq,usage_softirq,usage_steal,usage_guest,usage_guest_nice
root.cpu.host_0,1451606400000000000,eu-west-1,eu-west-1c,87,Ubuntu16.04LTS,x64,NYC,18,1,production,58,2,24,61,22,63,6,44,80,38
datatype,5,5,5,5,5,5,5,5,5,2,2,2,2,2,2,2,2,2,2

```

---

## `tsbs_load_iotdb` Additional Flags

### IoTDB related

#### `-host` (type: `string`, default: `localhost`)

Hostname of IoTDB instance.

#### `-port` (type: `string`, default: `6667`)

Which port to connect to on the database host.

#### `-user` (type: `string`, default: `root`)

The username of user who connect to IoTDB.

#### `-password` (type: `string`, default: `root`)

The password for user connecting to IoTDB.

#### `-timeout` (type: `int`, default: `0`)

Session timeout check in millisecond. After session config initialization,
client will try to get response from database server to make sure the connection
is established. This argument is the session timeout in millisecond. Use 0 for
no timeout.

---

## `tsbs_run_queries_iotdb` Additional Flags

### IoTDB related

#### `-host` (type: `string`, default: `localhost`)

Hostname of IoTDB instance.

#### `-port` (type: `string`, default: `6667`)

Which port to connect to on the database host.

#### `-user` (type: `string`, default: `root`)

The username of user who connect to IoTDB.

#### `-password` (type: `string`, default: `root`)

The password for user connecting to IoTDB.
